---
title: æˆ–è®¸æ˜¯ä¸€æœ¬å¯ä»¥å½»åº•æ”¹å˜ä½ åˆ· LeetCode æ•ˆç‡çš„é¢˜è§£ä¹¦
date: 2020-06-13
tags: [LeetCode, æˆ‘çš„ä¹¦]
---

ç»è¿‡äº†åŠå¹´æ—¶é—´æ‰“ç£¨ï¼ŒæŠ•å…¥è¯¸å¤šäººåŠ›ï¼Œè¿™æœ¬ LeetCode é¢˜è§£ä¹¦ç»ˆäºå¿«è¦å’Œå¤§å®¶è§é¢äº†ã€‚ç›®å‰å·²ç»å®Œæˆäº†å¤§éƒ¨åˆ†ç« èŠ‚çš„ç¼–å†™å·¥ä½œï¼Œé¢„è®¡ç»è¿‡ä¸€æ®µæ—¶é—´çš„æ‰“ç£¨å°±ä¼šå’Œå¤§å®¶è§é¢å•¦ ğŸ’ğŸ’ğŸ’ğŸ’ğŸ’ã€‚

<!-- more -->

# èƒŒæ™¯

è‡ª [LeetCode é¢˜è§£](https://github.com/azl397985856/leetcode) ï¼ˆç°åœ¨å·²ç»æ¥è¿‘ 30k star äº†ï¼‰é¡¹ç›®è¢«å¤§å®¶å¼€å§‹å…³æ³¨ï¼Œå°±æœ‰ä¸å°‘å‡ºç‰ˆç¤¾å¼€å§‹è”ç³»æˆ‘å†™ä¹¦ã€‚åˆšå¼€å§‹åçš„æ—¶å€™ï¼Œæˆ‘å¹¶æ²¡æœ‰è¿™ä¸ªæ‰“ç®—ï¼Œè§‰å¾—å†™è¿™ä¸ªç›¸å¯¹äºåšå®¢å½¢å¼çš„é¢˜è§£è¦è€—è´¹æ—¶é—´ï¼Œä¸”å¹¶ä¸ä¸€å®šæ•ˆæœæ¯”åšå®¢å½¢å¼çš„æ•ˆæœå¥½ã€‚åæ¥å½“æˆ‘å‘å¤§å®¶æåŠâ€œå‡ºç‰ˆç¤¾æ‰¾æˆ‘å†™ä¹¦â€è¿™ä»¶äº‹æƒ…çš„æ—¶å€™ï¼Œå¾ˆå¤šäººè¡¨ç¤ºâ€œæƒ³è¦ä¹°ä¹¦ï¼Œäºæ˜¯æˆ‘å°±å¼€å§‹æ‰“ç®—å†™è¿™æ ·ä¸€æœ¬ä¹¦ã€‚ä½†æ˜¯ä¸€ä¸ªå®Œå…¨æ²¡æœ‰å†™ä¹¦ç»éªŒçš„äººï¼Œç‹¬ç«‹å®Œæˆä¸€æœ¬ä¹¦å·¥ä½œé‡è¿˜æ˜¯è›®å¤§çš„ï¼Œå› æ­¤æˆ‘æ‰“ç®—å¯»æ±‚å…¶ä»–å¿—åŒé“åˆäººå£«çš„å¸®åŠ©ã€‚

# å›¢é˜Ÿä»‹ç»

å›¢é˜Ÿæˆå‘˜å¤§éƒ½æ¥è‡ª 985ï¼Œ 211 å­¦æ ¡è®¡ç®—æœºç³»ï¼Œå¤§å®¶ç»å¸¸å‚åŠ ç®—æ³•ç«èµ›ï¼Œä¹ŸåšæŒå‚åŠ  LeetCode å‘¨èµ›ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ç§¯ç´¯äº†å¾ˆå¤šç»éªŒï¼Œå¸Œæœ›å°†è¿™äº›ç»éªŒåˆ†äº«ç»™å¤§å®¶ï¼Œä»¥å‡å°‘å¤§å®¶åœ¨åˆ·é¢˜è¿‡ç¨‹ä¸­çš„é˜»ç¢ï¼Œè®©å¤§å®¶æ›´æœ‰æ•ˆç‡çš„åˆ·é¢˜ã€‚ æœ¬ä¹¦å°¤å…¶é€‚åˆé‚£äº›åˆšåˆšå¼€å§‹åˆ·é¢˜çš„äººï¼Œå¦‚æœä½ åˆšå¼€å§‹åˆ·é¢˜ï¼Œæˆ–è€…åˆ·äº†å¾ˆå¤šé¢˜é¢å¯¹æ–°é¢˜è¿˜æ˜¯æ— æ³•å¾ˆå¥½çš„è§£å†³ï¼Œé‚£ä¹ˆè¿™æœ¬ä¹¦è‚¯å®šå¾ˆé€‚åˆä½ ã€‚æœ€åæ¬¢è¿å¤§å®¶åŠ å…¥æˆ‘ä»¬çš„è¯»è€…ç¾¤å’Œä½œè€…è¿›è¡Œäº¤æµã€‚

> è¯»è€…ç¾¤ä¼šåœ¨æ–°ä¹¦å‡ºç‰ˆä¹‹åçš„ç¬¬ä¸€æ—¶é—´å¼€æ”¾ã€‚

- [ä½œè€… - xing](https://leetcode-cn.com/u/hlxing/)
- [ä½œè€… - lucifer](https://leetcode-cn.com/u/fe-lucifer/)
- [ä½œè€… - BY](https://leetcode-cn.com/u/bruceyuj/)
- [ä½œè€… - fanlu](https://www.fanlucloud.com/)
- [ä½œè€… - lazybing](https://leetcode.com/libinglimit/)

# æ ·å¼ 

è¿™é‡Œç»™å¤§å®¶å¼€æ”¾éƒ¨åˆ†ç« èŠ‚å†…å®¹ç»™å¤§å®¶ï¼Œè®©å¤§å®¶å°å°é²œã€‚å½“ç„¶ä¹Ÿæ¬¢è¿å¤§å®¶æå‡ºå®è´µçš„å»ºè®®ï¼Œå¸®åŠ©æˆ‘ä»¬å†™å‡ºæ›´å¥½çš„å†…å®¹ã€‚

æˆ‘ä»¬å¼€æ”¾äº†ç¬¬å…«ç« ç¬¬äº”å°èŠ‚ç»™å¤§å®¶çœ‹ï¼Œä»¥ä¸‹æ˜¯å…·ä½“å†…å®¹ï¼š

## 8.5 1206. è®¾è®¡è·³è¡¨

### é¢˜ç›®æè¿°

ä¸ä½¿ç”¨ä»»ä½•åº“å‡½æ•°ï¼Œè®¾è®¡ä¸€ä¸ªè·³è¡¨ã€‚

è·³è¡¨æ˜¯åœ¨ $O(logN)$ æ—¶é—´å†…å®Œæˆå¢åŠ ã€åˆ é™¤ã€æœç´¢æ“ä½œçš„æ•°æ®ç»“æ„ã€‚è·³è¡¨ç›¸æ¯”äºæ ‘å †ä¸çº¢é»‘æ ‘ï¼Œå…¶åŠŸèƒ½ä¸æ€§èƒ½ç›¸å½“ï¼Œå¹¶ä¸”è·³è¡¨çš„ä»£ç é•¿åº¦ç›¸è¾ƒä¸‹æ›´çŸ­ï¼Œå…¶è®¾è®¡æ€æƒ³ä¸é“¾è¡¨ç›¸ä¼¼ã€‚

è·³è¡¨ä¸­æœ‰å¾ˆå¤šå±‚ï¼Œæ¯ä¸€å±‚æ˜¯ä¸€ä¸ªçŸ­çš„é“¾è¡¨ã€‚åœ¨ç¬¬ä¸€å±‚çš„ä½œç”¨ä¸‹ï¼Œå¢åŠ ã€åˆ é™¤å’Œæœç´¢æ“ä½œçš„æ—¶é—´å¤æ‚åº¦ä¸è¶…è¿‡ $O(N)$ã€‚è·³è¡¨çš„æ¯ä¸€ä¸ªæ“ä½œçš„å¹³å‡æ—¶é—´å¤æ‚åº¦æ˜¯ $O(logN)$ï¼Œç©ºé—´å¤æ‚åº¦æ˜¯ $O(N)$ã€‚

åœ¨æœ¬é¢˜ä¸­ï¼Œä½ çš„è®¾è®¡åº”è¯¥è¦åŒ…å«è¿™äº›å‡½æ•°ï¼š

- bool search(int target) : è¿”å› target æ˜¯å¦å­˜åœ¨äºè·³è¡¨ä¸­ã€‚
- void add(int num):Â  æ’å…¥ä¸€ä¸ªå…ƒç´ åˆ°è·³è¡¨ã€‚
- bool erase(int num): åœ¨è·³è¡¨ä¸­åˆ é™¤ä¸€ä¸ªå€¼ï¼Œå¦‚æœ Â numÂ  ä¸å­˜åœ¨ï¼Œç›´æ¥è¿”å› false. å¦‚æœå­˜åœ¨å¤šä¸ª Â numÂ ï¼Œåˆ é™¤å…¶ä¸­ä»»æ„ä¸€ä¸ªå³å¯ã€‚

æ³¨æ„ï¼Œè·³è¡¨ä¸­å¯èƒ½å­˜åœ¨å¤šä¸ªç›¸åŒçš„å€¼ï¼Œä½ çš„ä»£ç éœ€è¦å¤„ç†è¿™ç§æƒ…å†µã€‚

æ ·ä¾‹ï¼š

```
Skiplist skiplist = new Skiplist();

skiplist.add(1);
skiplist.add(2);
skiplist.add(3);
skiplist.search(0);   // è¿”å› false
skiplist.add(4);
skiplist.search(1);   // è¿”å› true
skiplist.erase(0);    // è¿”å› falseï¼Œ0 ä¸åœ¨è·³è¡¨ä¸­
skiplist.erase(1);    // è¿”å› true
skiplist.search(1);   // è¿”å› falseï¼Œ1 å·²è¢«æ“¦é™¤
```

çº¦æŸæ¡ä»¶ï¼š
`0 <= num, target <= 20000`
æœ€å¤šè°ƒç”¨ Â 50000Â  æ¬¡ Â search, add, ä»¥åŠ Â erase æ“ä½œã€‚

### æ€è·¯

é¦–å…ˆï¼Œä½¿ç”¨è·³è¡¨ä¼šå°†æ•°æ®å­˜å‚¨æˆæœ‰åºçš„ã€‚åœ¨æ•°æ®ç»“æ„å½“ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸æœ‰ä¸¤ç§åŸºæœ¬çš„çº¿æ€§ç»“æ„ï¼Œç»“åˆæœ‰åºæ•°æ®ï¼Œè¡¨è¾¾å¦‚ä¸‹ï¼š

- æœ‰åºé“¾è¡¨ï¼Œæˆ‘ä»¬æœ‰ä¸‰ç§åŸºæœ¬æ“ä½œï¼š
  - æŸ¥æ‰¾æŒ‡å®šçš„æ•°æ®ï¼šæ—¶é—´å¤æ‚åº¦ä¸º $O(N)$, $N$ ä¸ºæ•°æ®ä½äºé“¾è¡¨çš„ä½ç½®ã€‚
  - æ’å…¥æŒ‡å®šçš„æ•°æ®ï¼šæ—¶é—´å¤æ‚åº¦ä¸º $O(N)$, $N$ ä¸ºæ•°æ®ä½äºé“¾è¡¨çš„ä½ç½®ã€‚å› ä¸ºæ’å…¥æ•°æ®ä¹‹å‰ï¼Œéœ€è¦å…ˆæŸ¥æ‰¾åˆ°å¯ä»¥æ’å…¥çš„ä½ç½®ã€‚
  - åˆ é™¤æŒ‡å®šçš„æ•°æ®ï¼šæ—¶é—´å¤æ‚åº¦ä¸º $O(N)$, $N$ ä¸ºæ•°æ®ä½äºé“¾è¡¨çš„ä½ç½®ã€‚å› ä¸ºåˆ é™¤æ•°æ®ä¹‹å‰ï¼Œéœ€è¦å…ˆæŸ¥æ‰¾åˆ°å¯ä»¥æ’å…¥çš„ä½ç½®ã€‚
- æœ‰åºæ•°ç»„ï¼š
  - æŸ¥æ‰¾æŒ‡å®šçš„æ•°æ®ï¼šå¦‚æœä½¿ç”¨äºŒåˆ†æŸ¥æ‰¾ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º $O(logN)$, $N$ ä¸ºæ•°æ®çš„ä¸ªæ•°ã€‚
  - æ’å…¥æŒ‡å®šçš„æ•°æ®ï¼šæ—¶é—´å¤æ‚åº¦ä¸º $O(N)$, å› ä¸ºæ•°ç»„æ˜¯é¡ºåºå­˜å‚¨ï¼Œæ’å…¥æ–°çš„æ•°æ®æ—¶ï¼Œæˆ‘ä»¬éœ€è¦å‘åç§»åŠ¨æŒ‡å®šä½ç½®åé¢çš„æ•°æ®ï¼Œè¿™é‡Œ $N$ ä¸ºæ•°æ®çš„ä¸ªæ•°ã€‚
  - åˆ é™¤æŒ‡å®šçš„æ•°æ®ï¼šæ—¶é—´å¤æ‚åº¦ä¸º $O(N)$, å› ä¸ºæ•°ç»„æ˜¯é¡ºåºå­˜å‚¨ï¼Œåˆ é™¤æ•°æ®æ—¶ï¼Œæˆ‘ä»¬éœ€è¦å‘å‰ç§»åŠ¨æŒ‡å®šä½ç½®åé¢çš„æ•°æ®ï¼Œè¿™é‡Œ $N$ ä¸ºæ•°æ®çš„ä¸ªæ•°ã€‚

è€Œç¥å¥‡çš„è·³è¡¨èƒ½å¤Ÿåœ¨ $O(logN)$ æ—¶é—´å†…å®Œæˆå¢åŠ ã€åˆ é™¤ã€æœç´¢æ“ä½œã€‚
ä¸‹é¢æˆ‘ä»¬åˆ†åˆ«åˆ†æå¢åŠ ã€åˆ é™¤å’Œæœç´¢è¿™ 3 ä¸ªä¸‰ä¸ªåŸºæœ¬æ“ä½œã€‚

#### è·³è¡¨çš„æŸ¥æ‰¾

ç°åœ¨æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥æè¿°è·³è¡¨æ˜¯å¦‚ä½•å®ç°çš„ã€‚å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªæœ‰åºé“¾è¡¨å¦‚ä¸‹å›¾ï¼š
![](https://tva1.sinaimg.cn/large/00831rSTly1gdl834i5t2j33340ecdil.jpg)
åŸå§‹æ–¹æ³•ä¸­ï¼ŒæŸ¥æ‰¾çš„æ—¶é—´å¤æ‚åº¦ä¸º $O(N)$ã€‚é‚£ä¹ˆå¦‚ä½•æ¥æé«˜é“¾è¡¨çš„æŸ¥è¯¢æ•ˆç‡å‘¢ï¼Ÿ
å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬å¯ä»¥ä»åŸå§‹é“¾è¡¨ä¸­æ¯ä¸¤ä¸ªå…ƒç´ æŠ½å‡ºæ¥ä¸€ä¸ªå…ƒç´ ï¼ŒåŠ ä¸Šä¸€çº§ç´¢å¼•ï¼Œå¹¶ä¸”ä¸€çº§ç´¢å¼•æŒ‡å‘åŸå§‹é“¾è¡¨ï¼š
![](https://tva1.sinaimg.cn/large/00831rSTly1gdl81x0d7vj33340rbwjx.jpg)
å¦‚æœæˆ‘ä»¬æƒ³è¦æŸ¥æ‰¾ 9 ï¼Œåœ¨åŸå§‹é“¾è¡¨ä¸­æŸ¥æ‰¾è·¯å¾„æ˜¯ `1->3->4->7->9`, è€Œåœ¨æ·»åŠ äº†ä¸€çº§ç´¢å¼•çš„æŸ¥æ‰¾è·¯å¾„æ˜¯ `1->4->9`ï¼Œå¾ˆæ˜æ˜¾ï¼ŒæŸ¥æ‰¾æ•ˆç‡æå‡äº†ã€‚
æŒ‰ç…§è¿™æ ·çš„æ€è·¯ï¼Œæˆ‘ä»¬åœ¨ç¬¬ 1 çº§ç´¢å¼•ä¸Šå†åŠ ç¬¬ 2 çº§ç´¢å¼•ï¼Œå†åŠ ç¬¬ 3 çº§ç´¢å¼•ï¼Œä»¥æ­¤ç±»æ¨ï¼Œè¿™æ ·åœ¨æ•°æ®é‡éå¸¸å¤§çš„æ—¶å€™ï¼Œä½¿å¾—æˆ‘ä»¬æŸ¥æ‰¾æ•°æ®çš„æ—¶é—´å¤æ‚åº¦ä¸º $O(logN)$ã€‚è¿™å°±æ˜¯è·³è¡¨çš„æ€æƒ³ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬é€šå¸¸æ‰€è¯´çš„â€œç©ºé—´æ¢æ—¶é—´â€ã€‚

#### è·³è¡¨çš„æ’å…¥

è·³è¡¨æ’å…¥æ•°æ®çœ‹èµ·æ¥å¾ˆç®€å•ï¼Œæˆ‘ä»¬éœ€è¦ä¿æŒæ•°æ®æœ‰åºï¼Œå› æ­¤ï¼Œç¬¬ä¸€æ­¥æˆ‘ä»¬éœ€è¦åƒæŸ¥æ‰¾å…ƒç´ ä¸€æ ·ï¼Œæ‰¾åˆ°æ–°å…ƒç´ åº”è¯¥æ’å…¥çš„ä½ç½®ï¼Œç„¶åå†æ’å…¥ã€‚

ä½†æ˜¯è¿™æ ·ä¼šå­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœæˆ‘ä»¬ä¸€ç›´å¾€åŸå§‹é“¾è¡¨ä¸­æ’å…¥æ•°æ®ï¼Œä½†æ˜¯ä¸æ›´æ–°ç´¢å¼•ï¼Œé‚£ä¹ˆä¼šå¯¼è‡´ä¸¤ä¸ªç´¢å¼•ç»“ç‚¹ä¹‹é—´çš„æ•°æ®éå¸¸å¤šï¼Œåœ¨æç«¯æƒ…å†µä¸‹ï¼Œè·³è¡¨ä¼šé€€åŒ–æˆå•é“¾è¡¨ï¼Œä»è€Œå¯¼è‡´æŸ¥æ‰¾æ•ˆç‡ç”± $O(logN)$ é€€åŒ–ä¸º $O(N)$ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æ’å…¥æ•°æ®çš„åŒæ—¶ï¼Œå¢åŠ ç›¸åº”çš„ç´¢å¼•æˆ–è€…é‡å»ºç´¢å¼•ã€‚

1. æ–¹æ¡ˆ 1ï¼šæ¯æ¬¡æ’å…¥æ•°æ®åï¼Œå°†è·³è¡¨çš„ç´¢å¼•å…¨éƒ¨åˆ é™¤åé‡å»ºï¼Œæˆ‘ä»¬çŸ¥é“ç´¢å¼•çš„ç»“ç‚¹ä¸ªæ•°ä¸º $N$ï¼ˆåœ¨ç©ºé—´å¤æ‚åº¦åˆ†ææ—¶ä¼šæœ‰æ˜ç¡®çš„æ•°å­¦æ¨å¯¼ï¼‰ï¼Œé‚£ä¹ˆæ¯æ¬¡é‡å»ºç´¢å¼•ï¼Œé‡å»ºçš„æ—¶é—´å¤æ‚åº¦è‡³å°‘æ˜¯ $O(N)$ çº§åˆ«ï¼Œå¾ˆæ˜æ˜¾ä¸å¯å–ã€‚
2. æ–¹æ¡ˆ 2ï¼šé€šè¿‡éšæœºæ€§æ¥ç»´æŠ¤ç´¢å¼•ã€‚å‡è®¾è·³è¡¨çš„æ¯ä¸€å±‚çš„æå‡æ¦‚ç‡ä¸º $\frac{1}{2}$ ï¼Œæœ€ç†æƒ³çš„æƒ…å†µå°±æ˜¯æ¯ä¸¤ä¸ªå…ƒç´ æå‡ä¸€ä¸ªå…ƒç´ åšç´¢å¼•ã€‚è€Œé€šå¸¸æ„ä¹‰ä¸Šï¼Œåªè¦å…ƒç´ çš„æ•°é‡è¶³å¤Ÿå¤šï¼Œä¸”æŠ½å–è¶³å¤Ÿéšæœºçš„è¯ï¼Œæˆ‘ä»¬å¾—åˆ°çš„ç´¢å¼•å°†ä¼šæ˜¯æ¯”è¾ƒå‡åŒ€çš„ã€‚å°½ç®¡ä¸æ˜¯æ¯ä¸¤ä¸ªæŠ½å–ä¸€ä¸ªï¼Œä½†æ˜¯å¯¹äºæŸ¥æ‰¾æ•ˆç‡æ¥è®²ï¼Œå½±å“å¹¶ä¸å¾ˆå¤§ã€‚æˆ‘ä»¬è¦çŸ¥é“ï¼Œè®¾è®¡è‰¯å¥½çš„æ•°æ®ç»“æ„å¾€å¾€éƒ½æ˜¯ç”¨æ¥åº”å¯¹å¤§æ•°æ®é‡çš„åœºæ™¯çš„ã€‚
   å› æ­¤ï¼Œæˆ‘ä»¬è¿™æ ·ç»´æŠ¤ç´¢å¼•ï¼š**éšæœºæŠ½å– $\frac{N}{2}$ ä¸ªå…ƒç´ ä½œä¸º 1 çº§ç´¢å¼•ï¼ŒéšæœºæŠ½å– $\frac{N}{4}$ ä½œä¸º 2 çº§ç´¢å¼•ï¼Œä»¥æ­¤ç±»æ¨ï¼Œä¸€ç›´åˆ°æœ€é¡¶å±‚ç´¢å¼•**ã€‚

é‚£ä¹ˆå…·ä½“ä»£ç è¯¥å¦‚ä½•å®ç°ï¼Œæ‰èƒ½å¤Ÿè®©è·³è¡¨åœ¨æ¯æ¬¡æ’å…¥æ–°å…ƒç´ æ—¶ï¼Œå°½é‡è®©è¯¥å…ƒç´ æœ‰ $\frac{1}{2}$ çš„æ¦‚ç‡å»ºç«‹ä¸€çº§ç´¢å¼•ã€$\frac{1}{4}$ çš„æ¦‚ç‡å»ºç«‹äºŒçº§ç´¢å¼•ã€$\frac{1}{8}$ çš„æ¦‚ç‡å»ºç«‹ä¸‰çº§ç´¢å¼•ï¼Œä»¥æ­¤ç±»æ¨ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ¦‚ç‡ç®—æ³•ã€‚

åœ¨é€šå¸¸çš„è·³è¡¨å®ç°å½“ä¸­ï¼Œæˆ‘ä»¬ä¼šè®¾è®¡ä¸€ä¸ª `randomLevel()` æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šéšæœºç”Ÿæˆ `1~MAX_LEVEL` ä¹‹é—´çš„æ•° (MAX_LEVEL è¡¨ç¤ºç´¢å¼•çš„æœ€é«˜å±‚æ•°ï¼‰

- randomLevel() æ–¹æ³•è¿”å› 1 è¡¨ç¤ºå½“å‰æ’å…¥çš„å…ƒç´ ä¸éœ€è¦å»ºç«‹ç´¢å¼•ï¼Œåªéœ€è¦å­˜å‚¨æ•°æ®åˆ°åŸå§‹é“¾è¡¨å³å¯ï¼ˆæ¦‚ç‡ 1/2ï¼‰
- randomLevel() æ–¹æ³•è¿”å› 2 è¡¨ç¤ºå½“å‰æ’å…¥çš„å…ƒç´ éœ€è¦å»ºç«‹ä¸€çº§ç´¢å¼•ï¼ˆæ¦‚ç‡ 1/4ï¼‰
- randomLevel() æ–¹æ³•è¿”å› 3 è¡¨ç¤ºå½“å‰æ’å…¥çš„å…ƒç´ éœ€è¦å»ºç«‹äºŒçº§ç´¢å¼•ï¼ˆæ¦‚ç‡ 1/8ï¼‰
- randomLevel() æ–¹æ³•è¿”å› 4 è¡¨ç¤ºå½“å‰æ’å…¥çš„å…ƒç´ éœ€è¦å»ºç«‹ä¸‰çº§ç´¢å¼•ï¼ˆæ¦‚ç‡ 1/16ï¼‰
- ......

å¯èƒ½æœ‰çš„åŒå­¦ä¼šæœ‰ç–‘é—®ï¼Œæˆ‘ä»¬éœ€è¦ä¸€çº§ç´¢å¼•ä¸­å…ƒç´ çš„ä¸ªæ•°æ—¶åŸå§‹é“¾è¡¨çš„ä¸€åŠï¼Œä½†æ˜¯æˆ‘ä»¬ `randomLevel()` æ–¹æ³•è¿”å› 2ï¼ˆå»ºç«‹ä¸€çº§ç´¢å¼•ï¼‰çš„æ¦‚ç‡æ˜¯ $\frac{1}{4}$, è¿™æ ·æ˜¯ä¸æ˜¯æœ‰é—®é¢˜å‘¢ï¼Ÿ
å®é™…ä¸Šï¼Œåªè¦`randomLevel()`æ–¹æ³•è¿”å›çš„æ•°å¤§äº 1ï¼Œæˆ‘ä»¬éƒ½ä¼šå»ºç«‹ä¸€çº§ç´¢å¼•ï¼Œè€Œè¿”å›å€¼ä¸º 1 çš„æ¦‚ç‡æ˜¯ $\frac{1}{2}$ã€‚æ‰€ä»¥ï¼Œå»ºç«‹ä¸€çº§ç´¢å¼•çš„æ¦‚ç‡å…¶å®æ˜¯$1- \frac{1}{2} = \frac{1}{2}$ã€‚åŒä¸Šï¼Œå½“ `randomLevel()` æ–¹æ³•è¿”å›å€¼ `>2` æ—¶ï¼Œæˆ‘ä»¬ä¼šå»ºç«‹äºŒçº§æˆ–äºŒçº§ä»¥ä¸Šçš„ç´¢å¼•ï¼Œéƒ½ä¼šåœ¨äºŒçº§ç´¢å¼•ä¸­æ·»åŠ å…ƒç´ ã€‚è€Œåœ¨äºŒçº§ç´¢å¼•ä¸­æ·»åŠ å…ƒç´ çš„æ¦‚ç‡æ˜¯ $1- \frac{1}{2} - \frac{1}{4} = \frac{1}{4}$ã€‚
ä»¥æ­¤ç±»æ¨ï¼Œæˆ‘ä»¬æ¨å¯¼å‡º `randomLevel()` ç¬¦åˆæˆ‘ä»¬çš„è®¾è®¡è¦æ±‚ã€‚

ä¸‹é¢æˆ‘ä»¬é€šè¿‡ä»¿ç…§ redis zset.c çš„ `randomLevel` çš„ä»£ç ï¼š

```python
##
# 1. SKIPLIST_P ä¸ºæå‡çš„æ¦‚ç‡ï¼Œæœ¬æ¡ˆä¾‹ä¸­æˆ‘ä»¬è®¾ç½®ä¸º 1/2, å¦‚æœæˆ‘ä»¬æƒ³è¦èŠ‚çœç©ºé—´åˆ©ç”¨æ•ˆç‡ï¼Œå¯ä»¥é€‚å½“çš„é™ä½è¯¥å€¼ï¼Œä»è€Œå‡å°‘ç´¢å¼•å…ƒç´ ä¸ªæ•°ã€‚åœ¨ redis ä¸­ SKIPLIST_P è¢«è®¾å®šä¸º 0.25ã€‚
# 2. redis ä¸­é€šè¿‡ä½¿ç”¨ä½è¿ç®—æ¥æå‡æµ®ç‚¹æ•°æ¯”è¾ƒçš„æ•ˆç‡ï¼Œåœ¨æœ¬æ¡ˆä¾‹ä¸­è¢«ç®€åŒ–
def randomLevel():
    level = 1
    while random() < SKIPLIST_P and level < MAX_LEVEL:
        level += 1
    return level
```

#### è·³è¡¨çš„åˆ é™¤

è·³è¡¨çš„åˆ é™¤ç›¸å¯¹æ¥è®²ç¨å¾®ç®€å•ä¸€äº›ã€‚æˆ‘ä»¬åœ¨åˆ é™¤æ•°æ®çš„åŒæ—¶ï¼Œéœ€è¦åˆ é™¤å¯¹åº”çš„ç´¢å¼•ç»“ç‚¹ã€‚

### ä»£ç 

```python
from typing import Optional
import random

class ListNode:
    def __init__(self, data: Optional[int] = None):
        self._data = data # é“¾è¡¨ç»“ç‚¹çš„æ•°æ®åŸŸï¼Œå¯ä»¥ä¸ºç©ºï¼ˆç›®çš„æ˜¯æ–¹ä¾¿åˆ›å»ºå¤´èŠ‚ç‚¹ï¼‰
        self._forwards = [] # å­˜å‚¨å„ä¸ªç´¢å¼•å±‚çº§ä¸­è¯¥ç»“ç‚¹çš„åé©±ç´¢å¼•ç»“ç‚¹

class Skiplist:

    _MAX_LEVEL = 16 # å…è®¸çš„æœ€å¤§ç´¢å¼•é«˜åº¦ï¼Œè¯¥å€¼æ ¹æ®å®é™…éœ€æ±‚è®¾ç½®

    def __init__(self):
        self._level_count = 1 # åˆå§‹åŒ–å½“å‰å±‚çº§ä¸º 1
        self._head = ListNode()
        self._head._forwards = [None] * self._MAX_LEVEL

    def search(self, target: int) -> bool:
        p = self._head
        for i in range(self._level_count - 1, -1, -1): # ä»æœ€é«˜ç´¢å¼•å±‚çº§ä¸æ–­æœç´¢ï¼Œå¦‚æœå½“å‰å±‚çº§æ²¡æœ‰ï¼Œåˆ™ä¸‹æ²‰åˆ°ä½ä¸€çº§çš„å±‚çº§
            while p._forwards[i] and p._forwards[i]._data < target:
                p = p._forwards[i]

        if p._forwards[0] and p._forwards[0]._data == target:
            return True

        return False

    def add(self, num: int) -> None:
        level = self._random_level() # éšæœºç”Ÿæˆç´¢å¼•å±‚çº§
        if self._level_count < level: # å¦‚æœå½“å‰å±‚çº§å°äº level, åˆ™æ›´æ–°å½“å‰æœ€é«˜å±‚çº§
            self._level_count = level
        new_node = ListNode(num) # ç”Ÿæˆæ–°ç»“ç‚¹
        new_node._forwards = [None] * level
        update = [self._head] * self._level_count # ç”¨æ¥ä¿å­˜å„ä¸ªç´¢å¼•å±‚çº§æ’å…¥çš„ä½ç½®ï¼Œä¹Ÿå°±æ˜¯æ–°ç»“ç‚¹çš„å‰é©±ç»“ç‚¹

        p = self._head
        for i in range(self._level_count - 1, -1, -1): # æ•´æ®µä»£ç è·å–æ–°æ’å…¥ç»“ç‚¹åœ¨å„ä¸ªç´¢å¼•å±‚çº§çš„å‰é©±èŠ‚ç‚¹ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯è¿™é‡Œæ˜¯ä½¿ç”¨çš„å½“å‰æœ€é«˜å±‚çº§æ¥å¾ªç¯ã€‚
            while p._forwards[i] and p._forwards[i]._data < num:
                p = p._forwards[i]

            update[i] = p

        for i in range(level): # æ›´æ–°éœ€è¦æ›´æ–°çš„å„ä¸ªç´¢å¼•å±‚çº§
            new_node._forwards[i] = update[i]._forwards[i]
            update[i]._forwards[i] = new_node

    def erase(self, num: int) -> bool:
        update = [None] * self._level_count
        p = self._head
        for i in range(self._level_count - 1, -1, -1):
            while p._forwards[i] and p._forwards[i]._data < num:
                p = p._forwards[i]
            update[i] = p

        if p._forwards[0] and p._forwards[0]._data == num:
            for i in range(self._level_count - 1, -1, -1):
                if update[i]._forwards[i] and update[i]._forwards[i]._data == num:
                    update[i]._forwards[i] = update[i]._forwards[i]._forwards[i]
            return True

        while self._level_count > 1 and not self._head._forwards[self._level_count]:
            self._level_count -= 1

        return False

    def _random_level(self, p: float = 0.5) -> int:
        level = 1
        while random.random() < p and level < self._MAX_LEVEL:
            level += 1
        return level
```

### å¤æ‚åº¦åˆ†æ

#### ç©ºé—´å¤æ‚åº¦

è·³è¡¨é€šè¿‡å»ºç«‹ç´¢å¼•æé«˜æŸ¥æ‰¾çš„æ•ˆç‡ï¼Œæ˜¯å…¸å‹çš„â€œç©ºé—´æ¢æ—¶é—´â€çš„æ€æƒ³ï¼Œé‚£ä¹ˆç©ºé—´å¤æ‚åº¦åˆ°åº•æ˜¯å¤šå°‘å‘¢ï¼Ÿ
æˆ‘ä»¬å‡è®¾åŸå§‹é“¾è¡¨æœ‰ $N$ ä¸ªå…ƒç´ ï¼Œä¸€çº§ç´¢å¼•æœ‰ $\frac{N}{2}$ï¼ŒäºŒçº§ç´¢å¼•æœ‰ $\frac{N}{4}$ï¼Œk çº§ç´¢å¼•æœ‰ $\frac{N}{2^k}$ ä¸ªå…ƒç´ ï¼Œè€Œæœ€é«˜çº§ç´¢å¼•ä¸€èˆ¬æœ‰ $2$ ä¸ªå…ƒç´ ã€‚æ‰€ä»¥ï¼Œç´¢å¼•ç»“ç‚¹çš„æ€»å’Œæ˜¯ $\frac{N}{2} + \frac{N}{2^2} + \frac{N}{2^3}+...+ 2 \approx N-2$ ï¼Œå› æ­¤å¯ä»¥å¾—å‡ºç©ºé—´å¤æ‚åº¦æ˜¯ $O(N)$, $N$ æ˜¯åŸå§‹é“¾è¡¨çš„é•¿åº¦ã€‚

ä¸Šé¢çš„å‡è®¾å‰ææ˜¯æ¯ä¸¤ä¸ªç»“ç‚¹æŠ½å‡ºä¸€ä¸ªç»“ç‚¹åˆ°ä¸Šå±‚ç´¢å¼•ã€‚é‚£ä¹ˆå¦‚æœæˆ‘ä»¬æ¯ä¸‰ä¸ªç»“ç‚¹æŠ½å‡ºä¸€ä¸ªç»“ç‚¹åˆ°ä¸Šå±‚ç´¢å¼•ï¼Œé‚£ä¹ˆç´¢å¼•æ€»å’Œå°±æ˜¯ $\frac{N}{3} + \frac{N}{3^2} + \frac{N}{3^3} + 9 + 3 + 1 \approx \frac{N}{2}$, é¢å¤–ç©ºé—´å‡å°‘äº†ä¸€åŠã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥é€šè¿‡å‡å°‘ç´¢å¼•çš„æ•°é‡æ¥å‡å°‘ç©ºé—´å¤æ‚åº¦ï¼Œä½†æ˜¯ç›¸åº”çš„ä¼šå¸¦æ¥æŸ¥æ‰¾æ•ˆç‡ä¸€å®šçš„ä¸‹é™ã€‚è€Œå…·ä½“è¿™ä¸ªé˜ˆå€¼è¯¥å¦‚ä½•é€‰æ‹©ï¼Œåˆ™è¦çœ‹å…·ä½“çš„åº”ç”¨åœºæ™¯ã€‚

å¦å¤–éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨å®é™…çš„åº”ç”¨å½“ä¸­ï¼Œç´¢å¼•ç»“ç‚¹å¾€å¾€ä¸éœ€è¦å­˜å‚¨å®Œæ•´çš„å¯¹è±¡ï¼Œåªéœ€è¦å­˜å‚¨å¯¹è±¡çš„ key å’Œå¯¹åº”çš„æŒ‡é’ˆå³å¯ã€‚å› æ­¤å½“å¯¹è±¡æ¯”ç´¢å¼•ç»“ç‚¹å ç”¨ç©ºé—´å¤§å¾ˆå¤šæ—¶ï¼Œç´¢å¼•ç»“ç‚¹æ‰€å çš„é¢å¤–ç©ºé—´ï¼ˆç›¸å¯¹åŸå§‹æ•°æ®æ¥è®²ï¼‰åˆå¯ä»¥å¿½ç•¥ä¸è®¡äº†ã€‚

#### æ—¶é—´å¤æ‚åº¦

##### æŸ¥æ‰¾çš„æ—¶é—´å¤æ‚åº¦

æ¥çœ‹çœ‹æ—¶é—´å¤æ‚åº¦ $O(logN)$ æ˜¯å¦‚ä½•æ¨å¯¼å‡ºæ¥çš„ï¼Œé¦–å…ˆæˆ‘ä»¬çœ‹ä¸‹å›¾ï¼š
![](https://tva1.sinaimg.cn/large/00831rSTly1gdl82ermgfj31rr0rs77h.jpg)

å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œæ­¤å¤„æˆ‘ä»¬å‡è®¾æ¯ä¸¤ä¸ªç»“ç‚¹ä¼šæŠ½å‡ºä¸€ä¸ªç»“ç‚¹æ¥ä½œä¸ºä¸Šä¸€çº§ç´¢å¼•çš„ç»“ç‚¹ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒåŸå§‹é“¾è¡¨æœ‰ $N$ ä¸ªå…ƒç´ ï¼Œä¸€çº§ç´¢å¼•æœ‰ $\frac{N}{2}$ï¼ŒäºŒçº§ç´¢å¼•æœ‰ $\frac{N}{4}$ï¼Œk çº§ç´¢å¼•æœ‰ $\frac{N}{2^k}$ ä¸ªå…ƒç´ ï¼Œè€Œæœ€é«˜çº§ç´¢å¼•ä¸€èˆ¬æœ‰ $2$ ä¸ªå…ƒç´ ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼šæœ€é«˜çº§ç´¢å¼• $x$ æ»¡è¶³ $2 = N/2^x$, ç”±æ­¤å…¬å¼å¯ä»¥å¾—å‡º $x = \log_2(N)-1$ , åŠ ä¸ŠåŸå§‹æ•°æ®è¿™ä¸€å±‚ï¼Œ è·³è¡¨çš„æ€»é«˜åº¦ä¸º $h = \log_2(N)$ã€‚
é‚£ä¹ˆï¼Œæˆ‘ä»¬åœ¨æŸ¥æ‰¾è¿‡ç¨‹ä¸­æ¯ä¸€å±‚ç´¢å¼•æœ€å¤šéå†å‡ ä¸ªå…ƒç´ å‘¢ï¼Ÿä»å›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºæ¥æ¯ä¸€å±‚æœ€å¤šéœ€è¦éå† 3 ä¸ªç»“ç‚¹ã€‚
å› æ­¤ï¼Œç”±å…¬å¼ `æ—¶é—´å¤æ‚åº¦ = ç´¢å¼•é«˜åº¦*æ¯å±‚ç´¢å¼•éå†å…ƒç´ ä¸ªæ•°`ï¼Œ å¯ä»¥å¾—å‡ºè·³è¡¨ä¸­æŸ¥æ‰¾ä¸€ä¸ªå…ƒç´ çš„æ—¶é—´å¤æ‚åº¦ä¸º $O(3 \times \log(N))$ï¼Œçœç•¥å¸¸æ•°å³ä¸º $O(\log(N))$ã€‚

##### æ’å…¥çš„æ—¶é—´å¤æ‚åº¦

è·³è¡¨çš„æ’å…¥åˆ†ä¸ºä¸¤éƒ¨åˆ†æ“ä½œï¼š

1. å¯»æ‰¾åˆ°å¯¹åº”çš„ä½ç½®ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º $O(logN)$, $N$ ä¸ºé“¾è¡¨é•¿åº¦ã€‚
2. æ’å…¥æ•°æ®ã€‚æˆ‘ä»¬åœ¨å‰é¢å·²ç»æ¨å¯¼å‡ºè·³è¡¨ç´¢å¼•çš„é«˜åº¦ä¸º $logN$ã€‚ å› æ­¤ï¼Œæˆ‘ä»¬å°†æ•°æ®æ’å…¥åˆ°å„å±‚ç´¢å¼•ä¸­çš„æœ€åæ—¶é—´å¤æ‚åº¦ä¸º $O(logN)$ã€‚

ç»¼ä¸Šæ‰€è¿°ï¼Œæ’å…¥æ“ä½œçš„æ—¶é—´å¤æ‚åº¦ä¸º $O(logN)$

##### åˆ é™¤çš„æ—¶é—´å¤æ‚åº¦

è·³è¡¨çš„åˆ é™¤æ“ä½œå’ŒæŸ¥æ‰¾ç±»ä¼¼ï¼Œåªæ˜¯éœ€è¦åœ¨æŸ¥æ‰¾ååˆ é™¤å¯¹åº”çš„å…ƒç´ ã€‚æŸ¥æ‰¾æ“ä½œçš„æ—¶é—´å¤æ‚åº¦æ˜¯ $logN$ã€‚é‚£ä¹ˆåé¢åˆ é™¤éƒ¨åˆ†ä»£ç çš„æ—¶é—´å¤æ‚åº¦æ˜¯å¤šå°‘å‘¢ï¼Ÿæˆ‘ä»¬çŸ¥é“åœ¨è·³è¡¨ä¸­ï¼Œæ¯ä¸€å±‚ç´¢å¼•éƒ½æ˜¯ä¸€ä¸ªæœ‰åºçš„å•é“¾è¡¨ï¼Œè€Œåˆ é™¤å•ä¸ªå…ƒç´ çš„å¤æ‚åº¦ä¸º $O(1)$, ç´¢å¼•å±‚æ•°ä¸º $logN$ï¼Œå› æ­¤åˆ é™¤éƒ¨åˆ†ä»£ç çš„æ—¶é—´å¤æ‚åº¦ä¸º$logN$ã€‚é‚£ä¹ˆåˆ é™¤æ“ä½œçš„æ€»æ—¶é—´å¤æ‚åº¦ä¸º- $O(logN) + O(logN) = 2O(logN)$ã€‚æˆ‘ä»¬å¿½ç•¥å¸¸æ•°éƒ¨åˆ†ï¼Œåˆ é™¤å…ƒç´ çš„æ—¶é—´å¤æ‚åº¦ä¸º $O(logN)$ã€‚

### æ‰©å±•

åœ¨å·¥ä¸šä¸Šï¼Œä½¿ç”¨è·³è¡¨çš„åœºæ™¯å¾ˆå¤šï¼Œä¸‹é¢åšäº›ç®€å•çš„ä»‹ç»ï¼Œæœ‰å…´è¶£çš„å¯ä»¥æ·±å…¥äº†è§£ï¼š

1. redis å½“ä¸­ zset ä½¿ç”¨äº†è·³è¡¨
2. HBase MemStore å½“ä¸­ä½¿ç”¨äº†è·³è¡¨
3. LevelDB å’Œ RocksDB éƒ½æ˜¯ LSM Tree ç»“æ„çš„æ•°æ®åº“ï¼Œå†…éƒ¨çš„ MemTable å½“ä¸­éƒ½ä½¿ç”¨äº†è·³è¡¨

# é…å¥—ç½‘ç«™

ç­‰æ–°ä¹¦å‘å¸ƒä¹‹åï¼Œæˆ‘ä»¬ä¼šåœ¨å®˜ç½‘å¼€è¾Ÿä¸€ä¸ªåŒºåŸŸï¼Œå¤§å®¶å¯ä»¥ç›´æ¥è®¿é—®æŸ¥çœ‹æœ¬ä¹¦é…å¥—çš„é…å¥—ä»£ç ï¼ŒåŒ…æ‹¬ JavaScriptï¼ŒJavaï¼ŒPython å’Œ C++ã€‚ ä¹Ÿæ¬¢è¿å¤§å®¶ç•™è¨€ç»™æˆ‘ä»¬è‡ªå·±æƒ³è¦æ”¯æŒçš„è¯­è¨€ï¼Œæˆ‘ä»¬ä¼šéƒ‘é‡è€ƒè™‘å¤§å®¶çš„æ„è§ã€‚

æ•ˆæœå¤§æ¦‚æ˜¯è¿™æ ·çš„ï¼š

![](https://tva1.sinaimg.cn/large/00831rSTly1gdl80ojj2rj31tw0u00x1.jpg)

# é¢„å®š

å¦‚æœä½ ä¹Ÿæƒ³è¦ç¬¬ä¸€æ—¶é—´è·å–åˆ°æˆ‘ä»¬çš„é¢˜è§£æ–°ä¹¦ï¼Œé‚£ä¹ˆè¯·å‘é€é‚®ä»¶åˆ° azl397985856@gmail.comï¼Œæ ‡é¢˜è‘—æ˜â€œä¹¦ç±ã€ŠLeetCode é¢˜è§£ã€‹é¢„å®šâ€å­—æ ·ã€‚
